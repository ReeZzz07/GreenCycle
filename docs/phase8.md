# Фаза 8. PWA и офлайн-функциональность

## 1. PWA Manifest
- Создан `apps/frontend/public/manifest.json` с настройками PWA
- Добавлены метатеги в `index.html` для поддержки PWA
- Настроены shortcuts для быстрого доступа к основным разделам
- Подготовлены настройки для установки на домашний экран

## 2. Service Worker и Workbox
- Интегрирован `vite-plugin-pwa` для автоматической генерации service worker
- Настроено кэширование статических ресурсов (JS, CSS, HTML, иконки)
- Реализовано кэширование Google Fonts (CacheFirst стратегия)
- Настроено кэширование API запросов (NetworkFirst стратегия с таймаутом)
- Настроено кэширование изображений (CacheFirst стратегия)
- Добавлен navigateFallback для поддержки SPA роутинга
- Реализована автоматическая регистрация service worker в production режиме

## 3. Offline функциональность
- Создан компонент `OfflineIndicator` для отображения статуса подключения
- Реализована утилита `pwa.ts` для работы с service worker и мониторинга онлайн статуса
- Создана очередь offline запросов (`offline-queue.ts`) для синхронизации при восстановлении соединения
- Добавлена обработка offline режима в API клиенте:
  - POST/PUT/DELETE запросы добавляются в очередь для последующей отправки
  - GET запросы отклоняются с сообщением об отсутствии соединения
  - Автоматическая обработка очереди при восстановлении соединения
- Реализована graceful degradation:
  - Приложение работает в readonly режиме при отсутствии соединения
  - Запросы на изменение данных сохраняются в очередь
  - Автоматическая синхронизация при восстановлении соединения

## 4. Иконки и ресурсы
- Подготовлена структура для иконок PWA (icon-192x192.png, icon-512x512.png)
- Добавлен robots.txt для SEO
- Настроены метатеги для правильного отображения приложения

## 5. Конфигурация
- Обновлён `vite.config.ts` с настройками PWA плагина
- Настроены стратегии кэширования для различных типов ресурсов
- Отключён service worker в dev режиме для упрощения разработки
- Включена автоматическая регистрация service worker в production

## Технические детали

### Service Worker
- Используется `vite-plugin-pwa` для автоматической генерации service worker
- Workbox стратегии:
  - **CacheFirst**: для статических ресурсов, шрифтов, изображений
  - **NetworkFirst**: для API запросов с таймаутом 3 секунды
- Автоматическое обновление приложения при наличии новой версии

### Offline Queue
- Локальное хранение очереди запросов в `localStorage`
- Автоматическая обработка очереди при восстановлении соединения
- Ограничение количества попыток (MAX_RETRIES = 3)
- Сохранение состояния очереди между сессиями

### Мониторинг подключения
- Отслеживание статуса подключения через `navigator.onLine`
- Слушатели событий `online` и `offline`
- Визуальная индикация статуса подключения в интерфейсе

## Примечания

### Иконки
Для полной функциональности PWA необходимо добавить иконки:
- `apps/frontend/public/icon-192x192.png` (192x192 пикселей)
- `apps/frontend/public/icon-512x512.png` (512x512 пикселей)

Иконки должны быть в формате PNG с прозрачным фоном или с зелёным фоном (#2e7d32) и логотипом GreenCycle.

### Тестирование
- Service Worker работает только в production режиме
- Для тестирования PWA функциональности необходимо собрать проект: `pnpm --filter frontend build`
- Затем запустить preview: `pnpm --filter frontend preview`
- Или использовать локальный сервер для тестирования установки PWA

## Следующие шаги
- Добавить иконки для PWA
- Протестировать установку PWA на различных устройствах
- Оптимизировать кэширование для больших объёмов данных
- Добавить уведомления о статусе синхронизации очереди

