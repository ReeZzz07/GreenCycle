# Roadmap GreenCycle

## Фаза 0. Подготовка и уточнение требований
- [x] Синхронизировать видение с партнёрами, уточнить приоритеты модулей и KPI.
- [x] Зафиксировать границы MVP полного цикла (без тестирования и деплоя) и критерии завершения.
- [x] Уточнить порядок интеграции PDF/Excel/Email в связке с бизнес-процессами.

## Фаза 1. Архитектура и проектирование
- [x] Дополнить ER-диаграмму деталями по индексации, ограничениям, хранимым представлениям.
- [x] Спроектировать REST API (ресурсы, статусы, схемы ошибок) и сформировать OpenAPI-спецификацию.
- [x] Сконфигурировать ролевую модель (RBAC-матрица) и сценарии аутентификации/авторизации.
- [x] Проработать UX-потоки на основе `docs/interfaceTZ.md` и собрать ключевые макеты экранов в Figma.

## Фаза 2. Базовая инфраструктура разработки
- [x] Настроить монорепозиторий (frontend/backend), общие скрипты, CI для сборки и статических проверок.
- [x] Описать docker-compose для локального развёртывания PostgreSQL и вспомогательных сервисов.
- [x] Добавить линтеры, форматтеры, commit hooks и шаблон миграций БД.

## Фаза 3. Бэкенд: фундамент
- [x] Инициализировать проект NestJS с модулями конфигурации, логирования и безопасного хранения секретов.
- [x] Реализовать модуль пользователей и ролей (`users`, `roles`), bcrypt-хеширование паролей, JWT/refresh.
- [x] Добавить middleware для аудита действий (created_by, updated_by), валидацию DTO и глобальные фильтры ошибок.
- [x] Подключить миграции БД, сиды для ролей и двух партнёров-админов.

## Фаза 4. Бэкенд: доменные модули
- [x] Модуль поставок и партий (`suppliers`, `shipments`, `batches`) с расчётом себестоимости и загрузкой документов.
- [x] Модуль склада: остатки, списания, триггеры на обновление `quantity_current`, журналы операций.
- [x] Модуль клиентов и CRM-атрибутов, фильтрация и поиск.
- [x] Модуль продаж (`sales`, `sale_items`) с привязкой партий и генерацией выкупных задач.
- [x] Модуль выкупа (`buybacks`, `buyback_items`) с планированием, статусами и связью с исходной продажей.
- [x] Модуль финансов (`accounts`, `transactions`, `partner_withdrawals`) с бизнес-валидацией и расчётом балансов.
- [x] Модуль уведомлений (in-app + email), расписание напоминаний 60/30/7 дней.
- [x] Модуль отчётов и аналитики: агрегации, параметрический конструктор, профили производительности.

## Фаза 5. Фронтенд: фундамент
- [x] Инициализировать Vite + React + TypeScript, настроить маршрутизацию и состояние (TanStack Query).
- [x] Подключить Mantine, тему проекта, глобальные стили и responsive-лейаут.
- [x] Реализовать механизм аутентификации, хранение токенов, защиту маршрутов и проверку ролей.
- [x] Создать базовые UI-компоненты (формы, таблицы, карточки, модальные окна, уведомления).

## Фаза 6. Фронтенд: модули
- [x] Дашборд: сводные метрики, графики движения средств, последние операции.
- [x] Раздел «Закупки»: список поставок, создание поставки с динамическим редактированием партий.
- [x] Раздел «Склад»: таблица остатков, форма списания, фильтры.
- [x] Раздел «Продажи»: поиск/создание клиента, подбор партий, оформление продажи и генерация документов.
- [x] Раздел «Выкуп»: канбан/табличный вид статусов, карточка выкупа, контроль сроков.
- [x] Раздел «Финансы»: обзор счетов, журнал операций, форма изъятия партнёров, виджеты балансов.
- [x] Раздел «Отчёты»: стандартные отчёты и конструктор с экспортом.
- [x] Раздел «Клиенты»: каталог, карточка с историей, быстрые действия.
- [x] Профиль пользователя: смена пароля, управление 2FA (при включении), настройки уведомлений.

## Фаза 7. Доменные интеграции
- [x] Настроить генерацию PDF (pdfmake/Puppeteer) для актов, счётов, накладных.
- [x] Реализовать экспорт в Excel через SheetJS, оптимизировать большие выборки.
- [x] Подключить SMTP (Nodemailer) с шаблонами писем и логированием отправок.
- [x] Добавить фоновые задачи (cron/queue) для напоминаний о выкупе и агрегирования метрик.

## Фаза 8. PWA и офлайн-функциональность
- [x] Подготовить manifest.json, иконки, настройки установки на домашний экран.
- [x] Интегрировать Workbox: кэширование статических ресурсов и последних форм/отчётов.
- [x] Реализовать graceful degradation при offline-режиме (readonly-режим, очередь синхронизации).

## Фаза 9. Документация и подготовка к передаче
- [x] Сформировать техническую документацию по API, структуре БД, модулям и интеграциям.
- [x] Составить пользовательские инструкции для ролей (админ, менеджер, бухгалтер, логист).
- [x] Подготовить checklist функциональности перед итоговой приёмкой.

