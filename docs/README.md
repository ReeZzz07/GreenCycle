# Документация GreenCycle

## Обзор

Добро пожаловать в документацию GreenCycle - системы полного учёта закупок, продаж, выкупа и финансов для бизнеса по продаже декоративных растений.

## Структура документации

### 1. [Техническое задание (TZ.md)](./TZ.md)
Полное техническое задание проекта с описанием бизнес-требований, функциональных требований, нефункциональных требований, технологии и архитектуры.

### 2. [Roadmap (roadmap.md)](./roadmap.md)
Пошаговый план разработки проекта с отметками о выполнении задач.

### 3. [API Документация (API.md)](./API.md)
Полная документация по REST API с описанием всех endpoints, параметров запросов и ответов, кодов ошибок.

### 4. [Структура базы данных (DATABASE.md)](./DATABASE.md)
Детальное описание структуры базы данных, таблиц, связей, индексов, триггеров и ограничений.

### 5. [Модули и интеграции (MODULES.md)](./MODULES.md)
Описание всех модулей системы (backend и frontend), их функциональности, зависимостей и интеграций.

### 6. [Пользовательская инструкция (USER_GUIDE.md)](./USER_GUIDE.md)
Подробная инструкция для пользователей системы с описанием всех функций и модулей.

### 7. [Checklist функциональности (CHECKLIST.md)](./CHECKLIST.md)
Чеклист для проверки функциональности системы перед итоговой приёмкой.

### 8. Фазы разработки
Документация по выполненным фазам разработки:
- [Фаза 4: Бэкенд модули](./phase4.md)
- [Фаза 5: Фронтенд фундамент](./phase5.md)
- [Фаза 6: Фронтенд модули](./phase6.md)
- [Фаза 8: PWA и офлайн-функциональность](./phase8.md)
- [Фаза 9: Документация и подготовка к передаче](./phase9.md)

### 9. [Завершение проекта (PROJECT_COMPLETION.md)](./PROJECT_COMPLETION.md)
Итоговый отчёт о завершении проекта с описанием всех выполненных задач и рекомендациями по передаче.

## Быстрый старт

### Установка

1. Клонируйте репозиторий
2. Установите зависимости: `pnpm install`
3. Настройте переменные окружения (см. [MODULES.md](./MODULES.md))
4. Запустите миграции: `pnpm --filter backend migration:run`
5. Запустите backend: `pnpm --filter backend start:dev`
6. Запустите frontend: `pnpm --filter frontend dev`

### Первый вход

- Email: `founder@greencycle.local`
- Пароль: `GreenCycle#2025`

**Внимание:** Измените пароль после первого входа!

## Архитектура

### Backend
- **Framework:** NestJS
- **Database:** PostgreSQL 15+
- **ORM:** TypeORM
- **Authentication:** JWT + Refresh Tokens
- **Validation:** class-validator + class-transformer
- **PDF Generation:** pdfmake
- **Email:** nodemailer
- **Scheduling:** @nestjs/schedule

### Frontend
- **Framework:** React 18
- **Build Tool:** Vite
- **UI Library:** Mantine UI v7
- **State Management:** TanStack Query
- **Routing:** React Router DOM
- **HTTP Client:** Axios
- **Excel Export:** xlsx
- **PWA:** vite-plugin-pwa

## Основные функции

### 1. Закупки
- Управление поставщиками
- Создание поставок
- Регистрация партий товаров
- Генерация накладных в PDF

### 2. Склад
- Учёт остатков товаров
- Списание товаров
- Автоматическое обновление остатков

### 3. Клиенты
- Управление клиентской базой
- Поиск клиентов
- История покупок клиентов

### 4. Продажи
- Создание продаж
- Отмена продаж
- Генерация счетов в PDF
- Автоматическое создание задач на выкуп

### 5. Выкуп
- Создание выкупов
- Управление статусами выкупов
- Генерация актов выкупа в PDF
- Автоматические напоминания (60, 30, 7 дней)

### 6. Финансы
- Управление счетами
- Управление транзакциями
- Изъятия партнёров
- Автоматический расчёт балансов

### 7. Отчёты
- Прибыль по поставкам
- Прибыль по клиентам
- Прогноз выкупа
- Движение средств
- Активность клиентов
- Экспорт в Excel

### 8. Уведомления
- In-app уведомления
- Email уведомления (опционально)
- Автоматические напоминания о выкупе

## Роли и права доступа

### Super Admin
- Полный доступ ко всем функциям
- Управление пользователями и ролями
- Технические настройки

### Admin
- Полный доступ ко всем бизнес-модулям
- Управление всеми данными

### Manager
- Управление клиентами
- Управление продажами
- Управление выкупами
- Просмотр отчётов

### Accountant
- Просмотр финансовых данных
- Просмотр отчётов
- Просмотр продаж и выкупов

### Logistic
- Управление поставками
- Управление складом
- Создание списаний

## Технические детали

### База данных
- PostgreSQL 15+
- Миграции через TypeORM
- Индексы на часто используемых полях
- Триггеры для автоматического обновления данных
- Ограничения целостности данных

### API
- REST API
- JWT аутентификация
- RBAC авторизация
- Валидация всех входных данных
- Глобальная обработка ошибок

### Frontend
- Progressive Web Application (PWA)
- Offline режим
- Service Worker для кэширования
- Автоматическое обновление приложения
- Адаптивный дизайн

## Безопасность

### Backend
- JWT токены с коротким временем жизни
- Refresh tokens для обновления access tokens
- Password hashing с bcrypt
- RBAC (Role-Based Access Control)
- Валидация всех входных данных
- Защита от SQL инъекций (TypeORM)
- CORS настройки

### Frontend
- Хранение токенов в localStorage
- Автоматическое обновление токенов
- Защита маршрутов (ProtectedRoute)
- Валидация форм
- Обработка ошибок

## Производительность

### Backend
- Кэширование запросов к базе данных
- Индексы на часто используемых полях
- Оптимизация запросов (eager loading, lazy loading)
- Транзакции для критических операций
- Pessimistic locking для обновления остатков

### Frontend
- Кэширование через TanStack Query
- Lazy loading компонентов
- Оптимизация bundle size
- Service Worker для кэширования статических ресурсов
- Offline очередь для запросов

## Деплой

### Backend
1. Сборка проекта: `pnpm --filter backend build`
2. Запуск миграций: `pnpm --filter backend migration:run`
3. Запуск приложения: `pnpm --filter backend start:prod`

### Frontend
1. Сборка проекта: `pnpm --filter frontend build`
2. Деплой статических файлов на сервер (nginx, Apache, etc.)

## Поддержка

Если у вас возникли вопросы или проблемы:
1. Обратитесь к администратору системы
2. Проверьте документацию
3. Проверьте логи приложения

## Лицензия

Проект разработан для внутреннего использования.

## Авторы

- Разработчик: _______________
- Дата создания: 10 ноября 2025 г.
- Дата завершения: 12 ноября 2025 г.
- Версия: 1.0
- Статус: ✅ ЗАВЕРШЁН

## История изменений

### Версия 1.0 (12 ноября 2025)
- Первая версия системы
- Реализация всех основных модулей
- PWA функциональность
- PDF генерация и Excel экспорт
- Email уведомления
- Фоновые задачи
- Полная документация
- Готовность к передаче

## Контакты

- Email: _______________
- Телефон: _______________
